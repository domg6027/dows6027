name: Reset DOWS6027 State

permissions:
  contents: write

on:
  workflow_dispatch:

jobs:
  reset:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Reset PDFS and tmp folders
        run: |
          echo "ğŸ§¹ Cleaning PDFS (except .nomedia)"
          if [ -d "PDFS" ]; then
            find PDFS -type f ! -name ".nomedia" -delete
          else
            mkdir -p PDFS
          fi

          echo "ğŸ§¹ Cleaning tmp"
          rm -rf tmp
          mkdir -p tmp

      - name: Reset data.json
        run: |
          cat > data.json << 'EOF'
          {
            "last_date_used": "2025-12-11",
            "last_URL_processed": "https://www.prophecynewswatch.com/article.cfm?recent_news_id=9256",
            "current_date": "2025-12-11",
            "last_article_number": 9256
          }
          EOF

      - name: Commit reset state
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

          git add PDFS tmp data.json || true

          if git diff --cached --quiet; then
            echo "Nothing to commit"
          else
            git commit -m "Reset PDFs, tmp, and data.json"
            git push
          fi
